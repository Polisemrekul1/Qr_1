<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QR_yemekhane</title>
  <style>
    body { font-family: Arial, sans-serif; max-width:640px; margin:40px auto; padding:20px; }
    .card { border:1px solid #ddd; padding:18px; border-radius:8px; }
    input[type="text"]{ width:100%; padding:8px; margin-top:8px; box-sizing:border-box;}
    button{ margin-top:10px; padding:10px 14px; cursor:pointer; }
    .hidden { display:none; }
    .small { color:#666; font-size:0.9rem; margin-top:8px; }
    .options { margin-top:12px; }
    .option { display:block; margin-bottom:6px; }
    img.question-img { max-width:100%; border-radius:6px; margin-top:10px; }
    iframe.video { width:100%; height:315px; border-radius:8px; margin-top:10px; }
  </style>
</head>
<body>
  <!-- 1️⃣ İsim Soyisim Girişi -->
  <div class="card" id="nameForm">
    <h2>Katılımcı Bilgileri</h2>
    <label>Ad Soyad:</label>
    <input id="fullname" type="text" placeholder="Ad Soyadınızı yazın" />
    <button id="startBtn">Teste Başla</button>
  </div>

  <!-- 2️⃣ Video Alanı -->
  <div class="card hidden" id="videoCard">
    <h2>İzlemeden Geçmeyin 🎥</h2>
    <iframe class="video"
      src="https://www.youtube.com/embed/BLEPakj1YTY?start=14"
      title="Video"
      allowfullscreen>
    </iframe>
    <button id="continueBtn">Devam Et →</button>
  </div>

  <!-- 3️⃣ Quiz Alanı -->
  <div class="card hidden" id="quiz">
    <h2 id="q-title"></h2>
    <div id="q-text"></div>
    <img id="q-img" class="question-img hidden" alt="Soru görseli">
    <div id="options" class="options"></div>
    <input id="answer" type="text" placeholder="Cevabınızı yazın" autocomplete="off" />
    <div>
      <button id="checkBtn">Cevabı Kontrol Et</button>
    </div>
    <div class="small" id="feedback"></div>
  </div>

 <!-- 4️⃣ Sonuç ekranı -->
<div class="card hidden" id="resultCard">
  <h2>Test Tamamlandı</h2>
  <p>Teşekkürler <span id="userName"></span>!</p>
  <p>İpucu: Okulumuzun kuruluş sebebi olan kişi nerededir?</p>
  <img
    src="https://burakbora.meb.k12.tr/meb_iys_dosyalar/34/14/218336/resimler/2020_04/k_10211911_25.jpg"
    alt="İpucu görseli"
    style="max-width:100%; border-radius:8px; margin-top:10px;"
  />
</div>

  <script>
    // 🔹 1. Sorular
    const questions = [
      {
       q: "Aşağıdakilerden hangisi deprem anında yapılmalıdır?",
        a: "Çök Kapan Tutun",
        img: "https://media.istockphoto.com/id/471332612/tr/foto%C4%9Fraf/cracked-road-concrete-close-up.jpg?s=612x612&w=0&k=20&c=0eG3dz6k1yWKkIR9pphTTXPEqpqkO2btuD95d4usqMY=",
        options: ["Camdan atlamak", "Yola çıkıp yere yatmak", "Çök Kapan Tutun", "Ocakları açmak"]
      },
      {
        q: "Fotoğraftaki kişi hangisini yapmalıdır?",
        a: "Tüpü yangının merkezine doğrultup kullanma",
        img: "./Emre Ynagın.jpg",
        options: ["Tüpü yangının merkezine doğrultup kullanma", "Yangının üstüne atlayıp tüpü geride bırakma", "Tüpü yangına fırlatma", "Tüpün piniyle oynama"]
      },
      {
        q: "Deprem çantasında hangisi olmamalıdır?",
        a: "Ps5 Pro",
        options: ["Sürekli kullandığımız ilaçlar", "Mevsimlik kıyafetler", "Konserve yiyecekler", "Ps5 Pro"]
      }
    ];

    // 🔹 2. HTML elemanlarını yakala
    const nameForm = document.getElementById('nameForm');
    const videoCard = document.getElementById('videoCard');
    const quiz = document.getElementById('quiz');
    const resultCard = document.getElementById('resultCard');
    const userNameSpan = document.getElementById('userName');
    const fullnameInput = document.getElementById('fullname');
    const startBtn = document.getElementById('startBtn');
    const continueBtn = document.getElementById('continueBtn');
    const qTitle = document.getElementById('q-title');
    const qText = document.getElementById('q-text');
    const qImg = document.getElementById('q-img');
    const optionsDiv = document.getElementById('options');
    const answerInput = document.getElementById('answer');
    const checkBtn = document.getElementById('checkBtn');
    const feedback = document.getElementById('feedback');

    // 🔹 3. Değişkenler
    let idx = 0;
    let fullname = "";

    // 🔹 4. Google Script (istersen aktif et)
    const scriptURL = "https://script.google.com/macros/s/AKfycbx0PmtZag9H7qK-825dceXNEfRr85XaZVmJdkxBtIPdo_uG7-RqZnw17fWg9NPe7ie1/exec";

    // 🔹 5. Testi başlat → video göster
    startBtn.onclick = () => {
      fullname = fullnameInput.value.trim();
      if (!fullname) {
        alert("Lütfen ad soyad girin.");
        return;
      }
      nameForm.classList.add('hidden');
      videoCard.classList.remove('hidden');
    };

    // 🔹 6. Videodan sonra → sorulara geç
    continueBtn.onclick = () => {
      videoCard.classList.add('hidden');
      quiz.classList.remove('hidden');
      showQuestion(idx);
    };

    // 🔹 7. Soru göster
    function showQuestion(i){
      if(i >= questions.length){
        finishTest();
        return;
      }

      const q = questions[i];
      qTitle.textContent = `Soru ${i+1}`;
      qText.textContent = q.q;

      if(q.img){
        qImg.src = q.img;
        qImg.classList.remove('hidden');
      } else {
        qImg.classList.add('hidden');
      }

      optionsDiv.innerHTML = "";
      if(q.options && q.options.length){
        q.options.forEach(opt => {
          const btn = document.createElement("button");
          btn.textContent = opt;
          btn.className = "option";
          btn.onclick = () => {
            answerInput.value = opt;
          };
          optionsDiv.appendChild(btn);
        });
      }

      answerInput.value = "";
      answerInput.focus();
      feedback.textContent = "";
    }

    // 🔹 8. Cevabı kontrol et
    function normalize(s){ return String(s || "").trim().toLowerCase(); }

    function checkAnswer(){
      const given = normalize(answerInput.value);
      const correct = normalize(questions[idx].a);

      if(given === ""){
        feedback.textContent = "Lütfen bir cevap yazın.";
        return;
      }

      const isCorrect = (given === correct);

      sendToGoogleSheet({
        adsoyad: fullname,
        soru: questions[idx].q,
        cevap: given,
        dogru: isCorrect ? "Evet" : "Hayır"
      });

      if(isCorrect){
        finishTest();
      } else {
        idx++;
        showQuestion(idx);
      }
    }

    checkBtn.addEventListener('click', checkAnswer);
    answerInput.addEventListener('keydown', e => { if(e.key === 'Enter') checkAnswer(); });

    // 🔹 9. Test bitince
    function finishTest(){
      quiz.classList.add('hidden');
      resultCard.classList.remove('hidden');
      userNameSpan.textContent = fullname;
    }

    // 🔹 10. Google Sheet'e gönder
    function sendToGoogleSheet(record) {
      fetch(scriptURL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(record)
      }).catch(err => console.log("Veri gönderilemedi:", err));
    }
  </script>
</body>
</html>


