<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QR_yemekhane</title>
  <style>
    body { font-family: Arial, sans-serif; max-width:640px; margin:40px auto; padding:20px; }
    .card { border:1px solid #ddd; padding:18px; border-radius:8px; }
    input[type="text"]{ width:100%; padding:8px; margin-top:8px; box-sizing:border-box;}
    button{ margin-top:10px; padding:10px 14px; cursor:pointer; }
    .hidden { display:none; }
    .small { color:#666; font-size:0.9rem; margin-top:8px; }
    .options { margin-top:12px; }
    .option { display:block; margin-bottom:6px; }
    img.question-img { max-width:100%; border-radius:6px; margin-top:10px; }
  </style>
</head>
<body>
  <!-- 1ï¸âƒ£ Ä°sim Soyisim GiriÅŸi -->
  <div class="card" id="nameForm">
    <h2>KatÄ±lÄ±mcÄ± Bilgileri</h2>
    <label>Ad Soyad:</label>
    <input id="fullname" type="text" placeholder="Ad SoyadÄ±nÄ±zÄ± yazÄ±n" />
    <button id="startBtn">Teste BaÅŸla</button>
  </div>

  <!-- 2ï¸âƒ£ Quiz AlanÄ± -->
  <div class="card hidden" id="quiz">
    <h2 id="q-title"></h2>
    <div id="q-text"></div>
    <img id="q-img" class="question-img hidden" alt="Soru gÃ¶rseli">
    <div id="options" class="options"></div>
    <input id="answer" type="text" placeholder="CevabÄ±nÄ±zÄ± yazÄ±n" autocomplete="off" />
    <div>
      <button id="checkBtn">CevabÄ± Kontrol Et</button>
    </div>
    <div class="small" id="feedback"></div>
  </div>

  <!-- 3ï¸âƒ£ SonuÃ§ ekranÄ± -->
  <div class="card hidden" id="resultCard">
    <h2>Test TamamlandÄ±</h2>
    <p>TeÅŸekkÃ¼rler <span id="userName"></span>!</p>
    <p>Ä°pucu: FransÄ±zlarÄ±n mekanÄ± neredir?</p>
  </div>

  <script>
    // ðŸ”¹ 1. Sorular
    const questions = [
      {
        q: "FotoÄŸraftaki kiÅŸi hangisini yapmalÄ±dÄ±r?",
        a: "TÃ¼pÃ¼ yangÄ±nÄ±n merkezine doÄŸrultup kullanma",
        img: "https://upload.wikimedia.org/wikipedia/commons/6/6b/Ankara_Kalesi%2C_Ankara_2018.jpg",
        options: ["TÃ¼pÃ¼ yangÄ±na fÄ±rlatma", "YangÄ±nÄ±n Ã¼stÃ¼ne atlayÄ±p tÃ¼pÃ¼ geride bÄ±rakma", "TÃ¼pÃ¼ yangÄ±nÄ±n merkezine doÄŸrultup kullanma", "TÃ¼pÃ¼n piniyle oynama"]
      },
      {
        q: "Bu hayvan hangisidir?",
        a: "kedi",
        img: "https://upload.wikimedia.org/wikipedia/commons/3/3a/Cat03.jpg",
        options: ["KÃ¶pek", "TavÅŸan", "Kedi", "KuÅŸ"]
      },
      {
        q: "2 + 2 kaÃ§tÄ±r?",
        a: "4",
        options: ["3", "4", "5", "6"]
      }
    ];

    // ðŸ”¹ 2. HTML elemanlarÄ±nÄ± yakala
    const nameForm = document.getElementById('nameForm');
    const quiz = document.getElementById('quiz');
    const resultCard = document.getElementById('resultCard');
    const userNameSpan = document.getElementById('userName');
    const fullnameInput = document.getElementById('fullname');
    const startBtn = document.getElementById('startBtn');
    const qTitle = document.getElementById('q-title');
    const qText = document.getElementById('q-text');
    const qImg = document.getElementById('q-img');
    const optionsDiv = document.getElementById('options');
    const answerInput = document.getElementById('answer');
    const checkBtn = document.getElementById('checkBtn');
    const feedback = document.getElementById('feedback');

    // ðŸ”¹ 3. DeÄŸiÅŸkenler
    let idx = 0;
    let fullname = "";

    // ðŸ”¹ 4. Google Script (istersen aktif et)
    const scriptURL = "https://script.google.com/macros/s/AKfycbx0PmtZag9H7qK-825dceXNEfRr85XaZVmJdkxBtIPdo_uG7-RqZnw17fWg9NPe7ie1/exec";

    // ðŸ”¹ 5. Testi baÅŸlat
    startBtn.onclick = () => {
      fullname = fullnameInput.value.trim();
      if (!fullname) {
        alert("LÃ¼tfen ad soyad girin.");
        return;
      }
      nameForm.classList.add('hidden');
      quiz.classList.remove('hidden');
      showQuestion(idx);
    };

    // ðŸ”¹ 6. Soru gÃ¶ster
    function showQuestion(i){
      if(i >= questions.length){
        finishTest();
        return;
      }

      const q = questions[i];
      qTitle.textContent = `Soru ${i+1}`;
      qText.textContent = q.q;

      // GÃ¶rsel varsa gÃ¶ster
      if(q.img){
        qImg.src = q.img;
        qImg.classList.remove('hidden');
      } else {
        qImg.classList.add('hidden');
      }

      // ÅžÄ±klarÄ± gÃ¶ster
      optionsDiv.innerHTML = "";
      if(q.options && q.options.length){
        q.options.forEach(opt => {
          const btn = document.createElement("button");
          btn.textContent = opt;
          btn.className = "option";
          btn.onclick = () => {
            answerInput.value = opt;
          };
          optionsDiv.appendChild(btn);
        });
      }

      answerInput.value = "";
      answerInput.focus();
      feedback.textContent = "";
    }

    // ðŸ”¹ 7. CevabÄ± kontrol et
    function normalize(s){ return String(s || "").trim().toLowerCase(); }

    function checkAnswer(){
      const given = normalize(answerInput.value);
      const correct = normalize(questions[idx].a);

      if(given === ""){
        feedback.textContent = "LÃ¼tfen bir cevap yazÄ±n.";
        return;
      }

      const isCorrect = (given === correct);

      // Google Sheet'e gÃ¶nder
      sendToGoogleSheet({
        adsoyad: fullname,
        soru: questions[idx].q,
        cevap: given,
        dogru: isCorrect ? "Evet" : "HayÄ±r"
      });

      if(isCorrect){
        finishTest();
      } else {
        idx++;
        showQuestion(idx);
      }
    }

    checkBtn.addEventListener('click', checkAnswer);
    answerInput.addEventListener('keydown', e => { if(e.key === 'Enter') checkAnswer(); });

    // ðŸ”¹ 8. Test bitince
    function finishTest(){
      quiz.classList.add('hidden');
      resultCard.classList.remove('hidden');
      userNameSpan.textContent = fullname;
    }

    // ðŸ”¹ 9. Veriyi Google Sheet'e gÃ¶nder
    function sendToGoogleSheet(record) {
      fetch(scriptURL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(record)
      }).catch(err => console.log("Veri gÃ¶nderilemedi:", err));
    }
  </script>
</body>
</html>
